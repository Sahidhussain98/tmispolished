<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layouts/default}"
>
  <head>
    <title>Dashboard</title>
  </head>
  <body>
    <main layout:fragment="content">
      <div class="p-6">
        <h4 class="page-title">Dashboard</h4>

        <!-- ✅ FIRST ROW OF METRICS -->
        <div class="row">
          <!-- Total Programs -->
          <div class="col-md-3">
            <div class="card card-stats card-primary">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-th-list text-primary icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Total Programs</p>
                      <h4 class="card-title" id="totalProgramsValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Total Venues -->
          <div class="col-md-3">
            <div class="card card-stats card-success">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-building text-success icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Total Venues</p>
                      <h4 class="card-title" id="totalVenuesValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Avg Completion -->
          <div class="col-md-3">
            <div class="card card-stats card-warning">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-line-chart text-warning icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Avg Completion</p>
                      <h4 class="card-title" id="avgCompletionValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Pending Events -->
          <div class="col-md-3">
            <div class="card card-stats card-danger">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-clock-o text-danger icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Upcoming Events</p>
                      <h4 class="card-title" id="pendingEventsValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- New Events -->
          <div class="col-md-3">
            <div class="card card-stats card-info">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-calendar-plus-o text-info icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">New Events</p>
                      <h4 class="card-title" id="newEventsValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Conducted Events -->
          <div class="col-md-3">
            <div class="card card-stats card-secondary">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-check-circle text-secondary icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Conducted Events</p>
                      <h4 class="card-title" id="conductedEventsValue">--</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Total Trainees -->
          <div class="col-md-3">
            <div class="card card-stats card-warning">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-users text-warning icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Total Trainees</p>
                      <h4 class="card-title">340</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Total Resource Persons -->
          <div class="col-md-3">
            <div class="card card-stats card-info">
              <div class="card-body">
                <div class="row">
                  <div class="col-5 text-center">
                    <i class="la la-user-circle text-info icon-big"></i>
                  </div>
                  <div class="col-7 d-flex align-items-center">
                    <div class="numbers">
                      <p class="card-category">Resource Persons</p>
                      <h4 class="card-title">28</h4>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- ✅ SECOND ROW: Tentative Programs & Recent Events -->
        <div class="row mt-4">
          <!-- Tentative Programs -->
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Upcoming Programs</h4>
              </div>
              <div class="card-body">
                <canvas id="userProgressChart"></canvas>
              </div>
            </div>
          </div>

          <!-- Recent Events -->
          <div class="col-md-6">
            <div class="card">
              <div class="card-header">
                <h4 class="card-title">Recent Events</h4>
              </div>
              <div class="card-body">
                <ul class="list-unstyled">
                  <li
                    th:each="activity : ${recentActivities}"
                    class="d-flex justify-content-between py-2 border-bottom"
                  >
                    <span th:text="${activity.description}">User completed Course X</span>
                    <span
                      class="text-muted small"
                      th:text="${#temporals.format(activity.timestamp, 'dd-MM-yyyy HH:mm')}"
                    >
                      01-01-2023 14:30
                    </span>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- ✅ JavaScript to fetch and populate dashboard data -->
      <script>
        window.onload = function () {
          fetch("/Sadmin/DashboardData")
            .then((response) => response.json())
            .then((data) => {
              console.log("Dashboard data:", data);

              document.getElementById("totalProgramsValue").innerText = data.totalPrograms;
              document.getElementById("totalVenuesValue").innerText = data.totalVenues;
              document.getElementById("avgCompletionValue").innerText = data.avgCompletion + "%";
              document.getElementById("pendingEventsValue").innerText = data.pendingEvents;
              document.getElementById("newEventsValue").innerText = data.newEvents;
              document.getElementById("conductedEventsValue").innerText = data.conductedEvents;
            })
            .catch((error) => console.error("Fetch failed:", error));
        };
      </script>
    </main>
  </body>
</html>
