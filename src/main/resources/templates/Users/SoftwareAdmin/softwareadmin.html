<!DOCTYPE html>
<html
        xmlns:th="http://www.thymeleaf.org"
        xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
        layout:decorate="~{layouts/default}"
>
<head>
  <title>Training Mission Director Dashboard</title>
  <style>
    /* --- Professional Dashboard CSS --- */
    .card-stats {
        border: none;
        border-radius: 10px;
        box-shadow: 0 4px 20px 0 rgba(0, 0, 0, 0.05);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        color: #fff;
        overflow: hidden;
        position: relative;
        min-height: 125px;
    }

    .card-stats:hover {
        transform: translateY(-3px);
        box-shadow: 0 6px 15px 0 rgba(0, 0, 0, 0.1);
    }

    .card-body {
        padding: 0.8rem;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100%;
    }

    .icon-big {
        font-size: 2.2rem;
        margin-bottom: 4px;
        opacity: 0.85;
    }

    .numbers {
        text-align: center;
        width: 100%;
    }

    .card-value {
        font-size: 1.8rem;
        font-weight: 700;
        margin-bottom: 0px;
        line-height: 1.1;
    }

    .card-category {
        font-size: 0.85rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        font-weight: 500;
        opacity: 0.9;
        margin-top: 2px;
        white-space: nowrap;
    }

    /* Colors for the 3 specific cards */
    .card-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); } /* Programs */
    .card-warning { background: linear-gradient(135deg, #f6d365 0%, #fda085 100%); } /* Trainees */
    .card-info { background: linear-gradient(135deg, #89f7fe 0%, #66a6ff 100%); }    /* Resource Persons */

    .list-group-item {
        border: none;
        padding: 0.8rem 0;
        border-bottom: 1px solid #f0f0f0;
    }
  </style>
</head>
<body>
<main layout:fragment="content">
  <div class="p-3">

    <h4 class="page-title mb-3 font-weight-bold text-dark pl-2">Dashboard Overview</h4>

    <div class="row">

      <div class="col-xl-4 col-md-6 mb-3">
        <div class="card card-stats card-primary">
          <div class="card-body">
            <i class="la la-th-list icon-big"></i>
            <div class="numbers">
              <h3 class="card-value" th:text="${stats != null ? stats.totalPrograms : 0}">0</h3>
              <p class="card-category">Total Programs</p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-4 col-md-6 mb-3">
        <div class="card card-stats card-info">
          <div class="card-body">
            <i class="la la-user-circle icon-big"></i>
            <div class="numbers">
              <h3 class="card-value"
                  th:text="${stats != null and stats.usersByRole != null and stats.usersByRole.containsKey('ROLE_10') ? stats.usersByRole['ROLE_10'] : 0}">
                0
              </h3>
              <p class="card-category">Resource Persons</p>
            </div>
          </div>
        </div>
      </div>

      <div class="col-xl-4 col-md-6 mb-3">
        <div class="card card-stats card-warning">
          <div class="card-body">
            <i class="la la-users icon-big"></i>
            <div class="numbers">
              <h3 class="card-value"
                  th:text="${stats != null and stats.usersByRole != null and stats.usersByRole.containsKey('ROLE_11') ? stats.usersByRole['ROLE_11'] : 0}">
                0
              </h3>
              <p class="card-category">Total Trainees</p>
            </div>
          </div>
        </div>
      </div>

    </div>

    <div class="row mt-2">
      <div class="col-lg-12 mb-4">
        <div class="card shadow-sm border-0" style="min-height: 300px;">
          <div class="card-header bg-white border-bottom-0 pt-3 pl-4">
            <h5 class="card-title font-weight-bold text-dark">Upcoming Programs</h5>
          </div>
          <div class="card-body pt-0">
            <ul id="upcomingEventsList" class="list-unstyled mt-2">
            </ul>
          </div>
        </div>
      </div>
    </div>

    <script>
      function fetchEvents() {
          const today = new Date();
          const todayStr = today.toISOString().split("T")[0];

          // Ensure this API endpoint exists in your backend
          fetch(`/api/events/list?date=${todayStr}`)
              .then((response) => {
                  if (!response.ok) throw new Error("API not found");
                  return response.json();
              })
              .then((eventData) => {
                  if (!eventData) return;

                  const upcomingEvents = eventData.upcomingEvents || [];
                  const listContainer = document.getElementById("upcomingEventsList");
                  listContainer.innerHTML = "";

                  if (upcomingEvents.length === 0) {
                      listContainer.innerHTML = '<li class="text-muted text-center py-4">No upcoming events found.</li>';
                  } else {
                      upcomingEvents.forEach((event) => {
                          const li = document.createElement("li");
                          li.className = "list-group-item d-flex justify-content-between align-items-center";

                          const pName = event.programeName ? event.programeName.programName : "Program";
                          const tName = event.topic ? event.topic.topicName : "Topic";

                          li.innerHTML = `
            <div>
              <div class="font-weight-bold text-dark" style="font-size: 0.95rem;">${pName}</div>
              <small class="text-muted">${tName}</small>
            </div>
            <span class="badge badge-primary badge-pill px-3 py-2">${event.startDate}</span>
          `;
                          listContainer.appendChild(li);
                      });
                  }
              })
              .catch((err) => {
                  console.log("Events API info:", err.message);
              });
      }

      document.addEventListener("DOMContentLoaded", function () {
          fetchEvents();
      });
    </script>
  </div>
</main>
</body>
</html>